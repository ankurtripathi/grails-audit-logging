<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- **************************************************************** -->
<!-- *  PLEASE KEEP COMPLICATED EXPRESSIONS OUT OF THESE TEMPLATES, * -->
<!-- *  i.e. only iterate & print data where possible. Thanks, Jez. * -->
<!-- **************************************************************** -->

<html>
<head>
<!-- Generated by groovydoc (1.6.7) on Thu Jun 24 15:24:59 EDT 2010 -->
<title>AuditLogListener (Groovy Documentation)</title>
<meta name="date" content="2010-06-24">
<link href="../../../../../../../../../groovy.ico" type="image/x-icon" rel="shortcut icon">
<link href="../../../../../../../../../groovy.ico" type="image/x-icon" rel="icon">
<link rel="stylesheet" type="text/css" href="../../../../../../../../../stylesheet.css" title="Style">
<script type="text/javascript">
function windowTitle()
{
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="AuditLogListener (Groovy Documentation)";
    }
}
</script>
<noscript>
</noscript>

</head><body onload="windowTitle();" bgcolor="white">
<hr>

<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>

  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <!--<TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  -->
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
<b>Groovy Documentation</b>
</EM></TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><!--<FONT SIZE="-2">
&nbsp;<A HREF="../../../../../../../../../groovy/lang/ExpandoMetaClass.ExpandoMetaProperty.html" title="class in groovy.lang"><B>PREV CLASS</B></A>&nbsp;

&nbsp;<A HREF="../../../../../../../../../groovy/lang/GroovyClassLoader.html" title="class in groovy.lang"><B>NEXT CLASS</B></A></FONT>--></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../../../../../../index.html?src/groovy/org/codehaus/groovy/grails/plugins/orm/auditable/AuditLogListener.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="AuditLogListener.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<script type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../../../../../../allclasses-frame.html"><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
  <A HREF="../../../../../../../../../allclasses-frame.html"><B>All Classes</B></A>
</noscript>

</FONT></TD>

</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#property_summary">PROPERTY</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#prop_detail">PROPERTY</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<!-- ========= END OF TOP NAVBAR ========= -->


<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
src.groovy.org.codehaus.groovy.grails.plugins.orm.auditable</FONT>
<BR>
<FONT CLASS="ClassTitleFont">Class AuditLogListener</FONT></H2>
<pre>java.lang.Object
  <img src='../../../../../../../../../inherit.gif'>src.groovy.org.codehaus.groovy.grails.plugins.orm.auditable.AuditLogListener
</pre><hr>
<PRE>class AuditLogListener

</PRE>

<P>
 <DL><DT><B>author:</B></DT><DD>shawn hartsock

 Grails Hibernate Interceptor for logging
 saves, updates, deletes and acting on
 individual properties changes... and
 delegating calls back to the Domain Class

 This class is based on the post at
 http://www.hibernate.org/318.html

 2008-04-17 created initial version 0.1
 2008-04-21 changes for version 0.2 include simpler events
  ... config file ... removed 'onUpdate' event.
 2008-06-04 added ignore fields feature
 2009-07-04 fetches its own session from sessionFactory to avoid transaction munging
 2009-09-05 getActor as a closure to allow developers to supply their own security plugins
 2009-09-25 rewrite.
 2009-10-04 preparing beta release
 </DD></DL>
</P>
<hr>


<!-- =========== NESTED CLASS SUMMARY =========== -->

<A NAME="nested_summary"><!-- --></A>


<!-- =========== ENUM CONSTANT SUMMARY =========== -->

<A NAME="enum_constant_summary"><!-- --></A>


<!-- =========== FIELD SUMMARY =========== -->

<A NAME="field_summary"><!-- --></A>


<!-- =========== PROPERTY SUMMARY =========== -->

<A NAME="property_summary"><!-- --></A>

    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
    <TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
    <TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
    <B>Property Summary</B></FONT></TH>
    </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
        <CODE>static&nbsp;java.lang.Long</CODE></FONT></TD>
        <TD>
            <CODE><B><A HREF="#TRUNCATE_LENGTH">TRUNCATE_LENGTH</A></B></CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
        <CODE>groovy.lang.Closure</CODE></FONT></TD>
        <TD>
            <CODE><B><A HREF="#actorClosure">actorClosure</A></B></CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
        <CODE>java.lang.String</CODE></FONT></TD>
        <TD>
            <CODE><B><A HREF="#actorKey">actorKey</A></B></CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
        <CODE>static&nbsp;Log</CODE></FONT></TD>
        <TD>
            <CODE><B><A HREF="#log">log</A></B></CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
        <CODE>def</CODE></FONT></TD>
        <TD>
            <CODE><B><A HREF="#saveAuditLog">saveAuditLog</A></B></CODE>
            <BR>
            <P> Performs special logging and save actions for AuditLogEvent class. </P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
        <CODE>java.lang.String</CODE></FONT></TD>
        <TD>
            <CODE><B><A HREF="#sessionAttribute">sessionAttribute</A></B></CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
        <CODE>SessionFactory</CODE></FONT></TD>
        <TD>
            <CODE><B><A HREF="#sessionFactory">sessionFactory</A></B></CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
        <CODE>java.lang.Long</CODE></FONT></TD>
        <TD>
            <CODE><B><A HREF="#truncateLength">truncateLength</A></B></CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
        <CODE>boolean</CODE></FONT></TD>
        <TD>
            <CODE><B><A HREF="#verbose">verbose</A></B></CODE>
            <BR>
            <P> The verbose flag flips on and off column by column change logging in
 insert and delete events. </P>
        </TD>
        </TR>
    
    </TABLE>
    &nbsp;


<!-- =========== ELEMENT SUMMARY =========== -->



<!-- ======== CONSTRUCTOR SUMMARY ======== -->

<A NAME="constructor_summary"><!-- --></A>

    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
    <TR BGCOLOR="#D5D5FF" CLASS="TableHeadingColor">
    <TD COLSPAN=2><FONT SIZE="+2">
    <B>Constructor Summary</B></FONT></TD>
    </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD>
            <CODE><B><a href="#AuditLogListener()">AuditLogListener</a></B>()</CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
    </TABLE>
    &nbsp;


<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>

    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
    <TR CLASS="TableHeadingColor">
    <TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2" CLASS="ClassHeadingFont">
    <B>Method Summary</B></FONT></TH>
    </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>java.lang.Object[]</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#addListener(Object[])">addListener</a></b>(java.lang.Object[] array)</CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>boolean</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#callHandlersOnly(def)">callHandlersOnly</a></b>(def entity)</CODE>
            <BR>
            <P>  we allow user's to specify
       static auditable = [handlersOnly:true]
  if they don't want us to log events for them and instead have their own plan.
   </P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>def</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#executeHandler(def, def, def, def)">executeHandler</a></b>(def event, def handler, def oldState, def newState)</CODE>
            <BR>
            <P> This calls the handlers based on what was passed in to it.
   </P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>java.lang.String</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#getActor()">getActor</a></b>()</CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>def</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#getEntityId(def)">getEntityId</a></b>(def event)</CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>SessionFactory</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#getSessionFactory()">getSessionFactory</a></b>()</CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>def</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#getUri()">getUri</a></b>()</CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>java.util.List</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#ignoreList(def)">ignoreList</a></b>(def entity)</CODE>
            <BR>
            <P> The default ignore field list is:  ['version','lastUpdated'] if you want
 to provide your own ignore list do so by specifying the ignore list like so:

   static auditable = [ignore:['version','lastUpdated','myField']]

 ... if instead you really want to trigger on version and lastUpdated changes you
 may specify an empty ignore list ... like so ...

   </P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>void</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#init()">init</a></b>()</CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>void</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#initialize(Configuration)">initialize</a></b>(Configuration config)</CODE>
            <BR>
            <P> Hibernate only saves changes when there are changes.
 </P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>def</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#isAuditableEntity(def)">isAuditableEntity</a></b>(def event)</CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>def</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#logChanges(def, def, def, def, def, def)">logChanges</a></b>(def newMap, def oldMap, def parentObject, def persistedObjectId, def eventName, def className)</CODE>
            <BR>
            <P> Leans heavily on the "toString()" of a property
 ... this feels crufty... should be tighter...
   </P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>private&nbsp;def</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#makeMap(String[], Object[])">makeMap</a></b>(java.lang.String[] names, java.lang.Object[] state)</CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>private&nbsp;void</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#onChange(PostUpdateEvent)">onChange</a></b>(PostUpdateEvent event)</CODE>
            <BR>
            <P> only if this is an auditable entity
   </P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>void</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#onPostInsert(PostInsertEvent)">onPostInsert</a></b>(PostInsertEvent event)</CODE>
            <BR>
            <P> I'm using the post insert event here instead of the pre-insert
 event so that I can log the id of the new entity after it
 is saved. </P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>void</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#onPostUpdate(PostUpdateEvent)">onPostUpdate</a></b>(PostUpdateEvent event)</CODE>
            <BR>
            <P> Now we get fancy. </P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>boolean</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#onPreDelete(PreDeleteEvent)">onPreDelete</a></b>(PreDeleteEvent event)</CODE>
            <BR>
            <P> We must use the preDelete event if we want to capture
 what the old object was like.
   </P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>void</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#registerSelf()">registerSelf</a></b>()</CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>void</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#setActorClosure(Closure)">setActorClosure</a></b>(groovy.lang.Closure closure)</CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>void</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#setSessionFactory(SessionFactory)">setSessionFactory</a></b>(SessionFactory sessionFactory)</CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>void</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#setVerbose(boolean)">setVerbose</a></b>(boolean verbose)</CODE>
            <BR>
            <P> if verbose is set to 'true' then you get a log event on
 each individually changed column/field sent to the database
 with a record of the old value and the new value.
   </P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>private&nbsp;boolean</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#significantChange(def, def, def)">significantChange</a></b>(def entity, def oldMap, def newMap)</CODE>
            <BR>
            <P> Prevent infinate loops of change logging by trapping
 non-significant changes. </P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>java.lang.String</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#truncate(def)">truncate</a></b>(def obj)</CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
        <TR BGCOLOR="white" CLASS="TableRowColor">
        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
            <CODE>java.lang.String</CODE></FONT>
        </TD>
        <TD>
            <CODE><b><a href="#truncate(def, int)">truncate</a></b>(def obj, int max)</CODE>
            <BR>
            <P></P>
        </TD>
        </TR>
    
    </TABLE>
    &nbsp;
<table BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
                <tr CLASS="TableSubHeadingColor"><th ALIGN="left" COLSPAN="2">
                <b>Methods inherited from class java.lang.Object</b>
                </th></tr>
                <tr class="TableRowColor"><td colspan='2'>wait, wait, wait, equals, toString, hashCode, getClass, notify, notifyAll</td></tr>
                </table>
                &nbsp;

<P>

<!-- ============ ENUM CONSTANT DETAIL ========== -->

<A NAME="enum_constant_detail"><!-- --></A>


<!-- =========== FIELD DETAIL =========== -->

<A NAME="field_detail"><!-- --></A>


<!-- =========== PROPERTY DETAIL =========== -->

<A NAME="prop_detail"><!-- --></A>

    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
    <TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
    <TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
    <B>Property Detail</B></FONT></TH>
    </TR>
    </TABLE>
    
        <A NAME="TRUNCATE_LENGTH"><!-- --></A><H3>TRUNCATE_LENGTH</H3>
        <PRE>public&nbsp;static&nbsp;java.lang.Long <B>TRUNCATE_LENGTH</B></PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="actorClosure"><!-- --></A><H3>actorClosure</H3>
        <PRE>groovy.lang.Closure <B>actorClosure</B></PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="actorKey"><!-- --></A><H3>actorKey</H3>
        <PRE>java.lang.String <B>actorKey</B></PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="log"><!-- --></A><H3>log</H3>
        <PRE>public&nbsp;static&nbsp;final&nbsp;Log <B>log</B></PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="saveAuditLog"><!-- --></A><H3>saveAuditLog</H3>
        <PRE>def <B>saveAuditLog</B></PRE>
        <DL>
        <DD> Performs special logging and save actions for AuditLogEvent class. You cannot use
 the GORM save features to persist this class on transactional databases due to timing
 conflicts with the session. Due to problems in this routine on some databases
 this closure has comprehensive trace logging in it for your diagnostics.

 It has also been written as a closure for your sake so that you may over-ride the
 save closure with your own code (should your particular database not work with this code)
 you may over-ride the definition of this closure using ... TODO allow over-ride via config

 To debug in Config.groovy set: 
    log4j.debug 'org.codehaus.groovy.grails.plugins.orm.auditable.AuditLogListener'
 or
    log4j.trace 'org.codehaus.groovy.grails.plugins.orm.auditable.AuditLogListener'

 SEE: GRAILSPLUGINS-391
   
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="sessionAttribute"><!-- --></A><H3>sessionAttribute</H3>
        <PRE>java.lang.String <B>sessionAttribute</B></PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="sessionFactory"><!-- --></A><H3>sessionFactory</H3>
        <PRE>SessionFactory <B>sessionFactory</B></PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="truncateLength"><!-- --></A><H3>truncateLength</H3>
        <PRE>java.lang.Long <B>truncateLength</B></PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="verbose"><!-- --></A><H3>verbose</H3>
        <PRE>boolean <B>verbose</B></PRE>
        <DL>
        <DD> The verbose flag flips on and off column by column change logging in
 insert and delete events. If this is true then all columns are logged
 each as an individual event.
   
        </DD>
        <P>
        </DL>
        <HR>
    
    &nbsp;


<!-- =========== ELEMENT DETAIL =========== -->

<A NAME="element_detail"><!-- --></A>


<!-- ========= CONSTRUCTOR DETAIL ======== -->

<A NAME="constructor_detail"><!-- --></A>

    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
    <TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
    <TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
    <B>Constructor Detail</B></FONT></TH>
    </TR>
    </TABLE>
    
        <A NAME="AuditLogListener()"><!-- --></A><H3>
        AuditLogListener</H3>
        <PRE><B>AuditLogListener</B>()</PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
    &nbsp;


<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>

    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
    <TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
    <TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
    <B>Method Detail</B></FONT></TH>
    </TR>
    </TABLE>
    
        <A NAME="addListener(Object[])"><!-- --></A><H3>
        addListener</H3>
        <PRE>java.lang.Object[] <B>addListener</B>(java.lang.Object[] array)</PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="callHandlersOnly(def)"><!-- --></A><H3>
        callHandlersOnly</H3>
        <PRE>boolean <B>callHandlersOnly</B>(def entity)</PRE>
        <DL>
        <DD>  we allow user's to specify
       static auditable = [handlersOnly:true]
  if they don't want us to log events for them and instead have their own plan.
   
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="executeHandler(def, def, def, def)"><!-- --></A><H3>
        executeHandler</H3>
        <PRE>public&nbsp;def <B>executeHandler</B>(def event, def handler, def oldState, def newState)</PRE>
        <DL>
        <DD> This calls the handlers based on what was passed in to it.
   
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="getActor()"><!-- --></A><H3>
        getActor</H3>
        <PRE>java.lang.String <B>getActor</B>()</PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="getEntityId(def)"><!-- --></A><H3>
        getEntityId</H3>
        <PRE>public&nbsp;def <B>getEntityId</B>(def event)</PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="getSessionFactory()"><!-- --></A><H3>
        getSessionFactory</H3>
        <PRE>SessionFactory <B>getSessionFactory</B>()</PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="getUri()"><!-- --></A><H3>
        getUri</H3>
        <PRE>public&nbsp;def <B>getUri</B>()</PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="ignoreList(def)"><!-- --></A><H3>
        ignoreList</H3>
        <PRE>java.util.List <B>ignoreList</B>(def entity)</PRE>
        <DL>
        <DD> The default ignore field list is:  ['version','lastUpdated'] if you want
 to provide your own ignore list do so by specifying the ignore list like so:

   static auditable = [ignore:['version','lastUpdated','myField']]

 ... if instead you really want to trigger on version and lastUpdated changes you
 may specify an empty ignore list ... like so ...

   static auditable = [ignore:[]]

   
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="init()"><!-- --></A><H3>
        init</H3>
        <PRE>void <B>init</B>()</PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="initialize(Configuration)"><!-- --></A><H3>
        initialize</H3>
        <PRE>public&nbsp;void <B>initialize</B>(Configuration config)</PRE>
        <DL>
        <DD> Hibernate only saves changes when there are changes.
 That means the onUpdate event was the same as the
 onChange with no parameters. I've eliminated onUpdate.
     
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="isAuditableEntity(def)"><!-- --></A><H3>
        isAuditableEntity</H3>
        <PRE>public&nbsp;def <B>isAuditableEntity</B>(def event)</PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="logChanges(def, def, def, def, def, def)"><!-- --></A><H3>
        logChanges</H3>
        <PRE>public&nbsp;def <B>logChanges</B>(def newMap, def oldMap, def parentObject, def persistedObjectId, def eventName, def className)</PRE>
        <DL>
        <DD> Leans heavily on the "toString()" of a property
 ... this feels crufty... should be tighter...
   
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="makeMap(String[], Object[])"><!-- --></A><H3>
        makeMap</H3>
        <PRE>private&nbsp;def <B>makeMap</B>(java.lang.String[] names, java.lang.Object[] state)</PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="onChange(PostUpdateEvent)"><!-- --></A><H3>
        onChange</H3>
        <PRE>private&nbsp;void <B>onChange</B>(PostUpdateEvent event)</PRE>
        <DL>
        <DD> only if this is an auditable entity
   
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="onPostInsert(PostInsertEvent)"><!-- --></A><H3>
        onPostInsert</H3>
        <PRE>public&nbsp;void <B>onPostInsert</B>(PostInsertEvent event)</PRE>
        <DL>
        <DD> I'm using the post insert event here instead of the pre-insert
 event so that I can log the id of the new entity after it
 is saved. That does mean the the insert event handlers
 can't work the way we want... but really it's the onChange
 event handler that does the magic for us.
   
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="onPostUpdate(PostUpdateEvent)"><!-- --></A><H3>
        onPostUpdate</H3>
        <PRE>public&nbsp;void <B>onPostUpdate</B>(PostUpdateEvent event)</PRE>
        <DL>
        <DD> Now we get fancy. Here we want to log changes...
 specifically we want to know what property changed,
 when it changed. And what the differences were.

 This works better from the onPreUpdate event handler
 but for some reason it won't execute right for me.
 Instead I'm doing a rather complex mapping to build
 a pair of state HashMaps that represent the old and
 new states of the object.

 The old and new states are passed to the object's
 'onChange' event handler. So that a user can work
 with both sets of values.

 Needs complex type testing BTW.
   
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="onPreDelete(PreDeleteEvent)"><!-- --></A><H3>
        onPreDelete</H3>
        <PRE>public&nbsp;boolean <B>onPreDelete</B>(PreDeleteEvent event)</PRE>
        <DL>
        <DD> We must use the preDelete event if we want to capture
 what the old object was like.
   
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="registerSelf()"><!-- --></A><H3>
        registerSelf</H3>
        <PRE>void <B>registerSelf</B>()</PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="setActorClosure(Closure)"><!-- --></A><H3>
        setActorClosure</H3>
        <PRE>void <B>setActorClosure</B>(groovy.lang.Closure closure)</PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="setSessionFactory(SessionFactory)"><!-- --></A><H3>
        setSessionFactory</H3>
        <PRE>void <B>setSessionFactory</B>(SessionFactory sessionFactory)</PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="setVerbose(boolean)"><!-- --></A><H3>
        setVerbose</H3>
        <PRE>void <B>setVerbose</B>(boolean verbose)</PRE>
        <DL>
        <DD> if verbose is set to 'true' then you get a log event on
 each individually changed column/field sent to the database
 with a record of the old value and the new value.
   
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="significantChange(def, def, def)"><!-- --></A><H3>
        significantChange</H3>
        <PRE>private&nbsp;boolean <B>significantChange</B>(def entity, def oldMap, def newMap)</PRE>
        <DL>
        <DD> Prevent infinate loops of change logging by trapping
 non-significant changes. Occasionally you can set up
 a change handler that will create a "trivial" object
 change that you don't want to trigger another change
 event. So this feature uses the ignore parameter
 to provide a list of fields for onChange to ignore.
   
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="truncate(def)"><!-- --></A><H3>
        truncate</H3>
        <PRE>java.lang.String <B>truncate</B>(def obj)</PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
        <A NAME="truncate(def, int)"><!-- --></A><H3>
        truncate</H3>
        <PRE>java.lang.String <B>truncate</B>(def obj, int max)</PRE>
        <DL>
        <DD>
        </DD>
        <P>
        </DL>
        <HR>
    
    &nbsp;


<!-- ========= END OF CLASS DATA ========= -->
<p>Groovy Documentation</p>
<hr>

</body>
</html>
